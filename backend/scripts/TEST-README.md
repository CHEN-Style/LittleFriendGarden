# ğŸ§ª API æµ‹è¯•æ–‡æ¡£

æœ¬æ–‡æ¡£ä»‹ç»å¦‚ä½•è¿è¡Œ Little Friend Garden åç«¯ API çš„è‡ªåŠ¨åŒ–æµ‹è¯•ã€‚

---

## ğŸ“‹ æµ‹è¯•æ¦‚è§ˆ

æˆ‘ä»¬ä¸ºä»¥ä¸‹ 5 ä¸ªæ ¸å¿ƒæ¨¡å—æä¾›äº†å®Œæ•´çš„æµ‹è¯•å¥—ä»¶ï¼š

| æ¨¡å— | æµ‹è¯•è„šæœ¬ | æµ‹è¯•æ•°é‡ | çŠ¶æ€ |
|------|---------|---------|------|
| ğŸ¾ Pet API (å® ç‰©ç®¡ç†) | `test-pet-api.js` | 17 | âœ… |
| âš–ï¸ Weight API (ä½“é‡è®°å½•) | `test-weight-api.js` | 8 | âœ… |
| ğŸ– Feeding API (å–‚å…»è®°å½•) | `test-feeding-api.js` | 8 | âœ… |
| ğŸ’Š Medical API (åŒ»ç–—è®°å½•) | `test-medical-api.js` | 8 | âœ… |
| â° Reminder API (æé†’ç®¡ç†) | `test-reminder-api.js` | 9 | âœ… |

**æ€»è®¡**: 50 ä¸ªæµ‹è¯•ç”¨ä¾‹

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å‡†å¤‡å·¥ä½œ

ç¡®ä¿åç«¯æœåŠ¡æ­£åœ¨è¿è¡Œï¼š

```bash
npm run dev
```

### 2. è¿è¡Œæ‰€æœ‰æµ‹è¯•

```bash
npm test
# æˆ–
npm run test:all
```

### 3. è¿è¡Œå•ä¸ªæ¨¡å—æµ‹è¯•

```bash
# æµ‹è¯•å® ç‰© API
npm run test:pet

# æµ‹è¯•ä½“é‡è®°å½• API
npm run test:weight

# æµ‹è¯•å–‚å…»è®°å½• API
npm run test:feeding

# æµ‹è¯•åŒ»ç–—è®°å½• API
npm run test:medical

# æµ‹è¯•æé†’ API
npm run test:reminder
```

---

## ğŸ“ æµ‹è¯•è¯¦æƒ…

### 1. ğŸ¾ Pet API æµ‹è¯• (17 ä¸ªæµ‹è¯•)

**æµ‹è¯•è„šæœ¬**: `scripts/test-pet-api.js`

**æµ‹è¯•è¦†ç›–**:
- âœ… åˆ›å»ºå® ç‰©ï¼ˆåŸºç¡€åŠŸèƒ½ï¼‰
- âœ… åˆ›å»ºå¤šä¸ªä¸åŒç‰©ç§çš„å® ç‰©
- âœ… è·å–ç”¨æˆ·çš„æ‰€æœ‰å® ç‰©
- âœ… è·å–å® ç‰©è¯¦æƒ…
- âœ… æ›´æ–°å® ç‰©ä¿¡æ¯
- âœ… æ·»åŠ å…±äº«æˆå‘˜
- âœ… å…±äº«æˆå‘˜æƒé™ï¼ˆåªè¯»ï¼‰
- âœ… ç§»é™¤å…±äº«æˆå‘˜
- âœ… åˆ é™¤å® ç‰©ï¼ˆè½¯åˆ é™¤ï¼‰
- âœ… è¾“å…¥éªŒè¯ï¼ˆç¼ºå°‘å¿…å¡«å­—æ®µï¼‰
- âœ… æšä¸¾å€¼éªŒè¯
- âœ… è®¤è¯é”™è¯¯å¤„ç†
- âœ… æƒé™é”™è¯¯å¤„ç†ï¼ˆéä¸»äººä¿®æ”¹ï¼‰
- âœ… æƒé™é”™è¯¯å¤„ç†ï¼ˆéä¸»äººåˆ é™¤ï¼‰
- âœ… èµ„æºä¸å­˜åœ¨é”™è¯¯
- âœ… ä¸èƒ½ç§»é™¤ä¸»ä¸»äºº
- âœ… åªæœ‰ä¸»ä¸»äººå¯ä»¥ç§»é™¤æˆå‘˜

**è¿è¡Œ**:
```bash
npm run test:pet
```

---

### 2. âš–ï¸ Weight API æµ‹è¯• (8 ä¸ªæµ‹è¯•)

**æµ‹è¯•è„šæœ¬**: `scripts/test-weight-api.js`

**æµ‹è¯•è¦†ç›–**:
- âœ… æ·»åŠ ä½“é‡è®°å½•
- âœ… è·å–å® ç‰©çš„ä½“é‡è®°å½•åˆ—è¡¨
- âœ… æ›´æ–°ä½“é‡è®°å½•
- âœ… åˆ é™¤ä½“é‡è®°å½•
- âœ… æ‰¹é‡å¯¼å…¥ä½“é‡è®°å½•
- âœ… è·å–ä½“é‡è¶‹åŠ¿åˆ†æ
- âœ… è¾“å…¥éªŒè¯
- âœ… æƒé™æ§åˆ¶

**API ç«¯ç‚¹**:
- `POST /api/weights` - æ·»åŠ ä½“é‡è®°å½•
- `GET /api/weights/pet/:petId` - è·å–ä½“é‡è®°å½•åˆ—è¡¨
- `GET /api/weights/:id` - è·å–ä½“é‡è®°å½•è¯¦æƒ…
- `PATCH /api/weights/:id` - æ›´æ–°ä½“é‡è®°å½•
- `DELETE /api/weights/:id` - åˆ é™¤ä½“é‡è®°å½•
- `POST /api/weights/batch` - æ‰¹é‡å¯¼å…¥
- `GET /api/weights/pet/:petId/trends` - è·å–è¶‹åŠ¿åˆ†æ

**è¿è¡Œ**:
```bash
npm run test:weight
```

---

### 3. ğŸ– Feeding API æµ‹è¯• (8 ä¸ªæµ‹è¯•)

**æµ‹è¯•è„šæœ¬**: `scripts/test-feeding-api.js`

**æµ‹è¯•è¦†ç›–**:
- âœ… æ·»åŠ å–‚å…»è®°å½•
- âœ… è·å–å® ç‰©çš„å–‚å…»è®°å½•åˆ—è¡¨
- âœ… æ›´æ–°å–‚å…»è®°å½•
- âœ… åˆ é™¤å–‚å…»è®°å½•
- âœ… æ‰¹é‡å¯¼å…¥å–‚å…»è®°å½•
- âœ… è·å–å–‚å…»ç»Ÿè®¡åˆ†æ
- âœ… é£Ÿç‰©ç±»å‹æšä¸¾éªŒè¯
- âœ… æƒé™æ§åˆ¶

**é£Ÿç‰©ç±»å‹**:
- `cat_food` - çŒ«ç²®
- `dog_food` - ç‹—ç²®
- `treats` - é›¶é£Ÿ
- `wet_food` - æ¹¿ç²®
- `raw_food` - ç”Ÿéª¨è‚‰
- `supplements` - è¥å…»è¡¥å……
- `other` - å…¶ä»–

**API ç«¯ç‚¹**:
- `POST /api/feedings` - æ·»åŠ å–‚å…»è®°å½•
- `GET /api/feedings/pet/:petId` - è·å–å–‚å…»è®°å½•åˆ—è¡¨
- `GET /api/feedings/:id` - è·å–å–‚å…»è®°å½•è¯¦æƒ…
- `PATCH /api/feedings/:id` - æ›´æ–°å–‚å…»è®°å½•
- `DELETE /api/feedings/:id` - åˆ é™¤å–‚å…»è®°å½•
- `POST /api/feedings/batch` - æ‰¹é‡å¯¼å…¥
- `GET /api/feedings/pet/:petId/stats` - è·å–ç»Ÿè®¡åˆ†æ

**è¿è¡Œ**:
```bash
npm run test:feeding
```

---

### 4. ğŸ’Š Medical API æµ‹è¯• (8 ä¸ªæµ‹è¯•)

**æµ‹è¯•è„šæœ¬**: `scripts/test-medical-api.js`

**æµ‹è¯•è¦†ç›–**:
- âœ… æ·»åŠ åŒ»ç–—è®°å½•
- âœ… è·å–å® ç‰©çš„åŒ»ç–—è®°å½•åˆ—è¡¨
- âœ… æ›´æ–°åŒ»ç–—è®°å½•
- âœ… åˆ é™¤åŒ»ç–—è®°å½•
- âœ… æ‰¹é‡å¯¼å…¥åŒ»ç–—è®°å½•
- âœ… è·å–åŒ»ç–—ç»Ÿè®¡åˆ†æ
- âœ… åŒ»ç–—ç±»å‹æšä¸¾éªŒè¯
- âœ… æƒé™æ§åˆ¶

**åŒ»ç–—ç±»å‹**:
- `vaccination` - ç–«è‹—æ¥ç§
- `deworming` - é©±è™«
- `checkup` - å¥åº·æ£€æŸ¥
- `treatment` - æ²»ç–—
- `surgery` - æ‰‹æœ¯
- `dental` - ç‰™ç§‘
- `grooming` - ç¾å®¹
- `other` - å…¶ä»–

**API ç«¯ç‚¹**:
- `POST /api/medicals` - æ·»åŠ åŒ»ç–—è®°å½•
- `GET /api/medicals/pet/:petId` - è·å–åŒ»ç–—è®°å½•åˆ—è¡¨
- `GET /api/medicals/:id` - è·å–åŒ»ç–—è®°å½•è¯¦æƒ…
- `PATCH /api/medicals/:id` - æ›´æ–°åŒ»ç–—è®°å½•
- `DELETE /api/medicals/:id` - åˆ é™¤åŒ»ç–—è®°å½•
- `POST /api/medicals/batch` - æ‰¹é‡å¯¼å…¥
- `GET /api/medicals/pet/:petId/stats` - è·å–ç»Ÿè®¡åˆ†æ

**è¿è¡Œ**:
```bash
npm run test:medical
```

---

### 5. â° Reminder API æµ‹è¯• (9 ä¸ªæµ‹è¯•)

**æµ‹è¯•è„šæœ¬**: `scripts/test-reminder-api.js`

**æµ‹è¯•è¦†ç›–**:
- âœ… åˆ›å»ºæé†’
- âœ… è·å–å® ç‰©çš„æé†’åˆ—è¡¨
- âœ… æ›´æ–°æé†’
- âœ… åˆ é™¤æé†’
- âœ… æ ‡è®°æé†’ä¸ºå·²å®Œæˆ
- âœ… è·å–å³å°†åˆ°æœŸçš„æé†’
- âœ… å¾ªç¯æé†’
- âœ… æé†’ç±»å‹æšä¸¾éªŒè¯
- âœ… æƒé™æ§åˆ¶

**æé†’ç±»å‹**:
- `vaccination` - ç–«è‹—æé†’
- `deworming` - é©±è™«æé†’
- `checkup` - ä½“æ£€æé†’
- `grooming` - ç¾å®¹æé†’
- `feeding` - å–‚é£Ÿæé†’
- `medication` - ç”¨è¯æé†’
- `other` - å…¶ä»–

**å¾ªç¯é—´éš”**:
- `daily` - æ¯æ—¥
- `weekly` - æ¯å‘¨
- `monthly` - æ¯æœˆ
- `yearly` - æ¯å¹´

**API ç«¯ç‚¹**:
- `POST /api/reminders` - åˆ›å»ºæé†’
- `GET /api/reminders/pet/:petId` - è·å–æé†’åˆ—è¡¨
- `GET /api/reminders/:id` - è·å–æé†’è¯¦æƒ…
- `PATCH /api/reminders/:id` - æ›´æ–°æé†’
- `DELETE /api/reminders/:id` - åˆ é™¤æé†’
- `POST /api/reminders/:id/complete` - æ ‡è®°ä¸ºå·²å®Œæˆ
- `GET /api/reminders/upcoming` - è·å–å³å°†åˆ°æœŸçš„æé†’

**è¿è¡Œ**:
```bash
npm run test:reminder
```

---

## âš™ï¸ é…ç½®é€‰é¡¹

### ç¯å¢ƒå˜é‡

æµ‹è¯•è„šæœ¬æ”¯æŒä»¥ä¸‹ç¯å¢ƒå˜é‡ï¼š

```bash
# API åŸºç¡€åœ°å€ï¼ˆé»˜è®¤ï¼šhttp://localhost:3000/apiï¼‰
API_BASE_URL=http://localhost:3000/api

# è¯·æ±‚è¶…æ—¶æ—¶é—´ï¼ˆé»˜è®¤ï¼š30000msï¼‰
TIMEOUT=30000

# è°ƒè¯•æ¨¡å¼ï¼ˆé»˜è®¤ï¼šfalseï¼‰
DEBUG=true
```

### ä½¿ç”¨ç¤ºä¾‹

```bash
# ä½¿ç”¨è‡ªå®šä¹‰ API åœ°å€
API_BASE_URL=http://192.168.1.100:3000/api npm run test:pet

# å¯ç”¨è°ƒè¯•æ¨¡å¼
DEBUG=true npm run test:pet

# ç»„åˆä½¿ç”¨
API_BASE_URL=http://192.168.1.100:3000/api DEBUG=true npm run test:all
```

---

## ğŸ“Š æµ‹è¯•è¾“å‡º

### æˆåŠŸç¤ºä¾‹

```
ğŸš€ å¼€å§‹ Pet Weight API å®Œæ•´æµ‹è¯•

ğŸ“ API åœ°å€: http://localhost:3000/api
â±ï¸  è¶…æ—¶è®¾ç½®: 30000ms

ğŸ“ æµ‹è¯• 1: æ·»åŠ ä½“é‡è®°å½• - åŸºç¡€åŠŸèƒ½
âœ… åˆ›å»ºæµ‹è¯•ç”¨æˆ·: testuser0_1730000000000@example.com
âœ… åˆ›å»ºæµ‹è¯•å® ç‰©: å°ç™½ (ID: xxx)
âœ… åˆ›å»ºä½“é‡è®°å½•æˆåŠŸ: 5.2kg (ID: xxx)

â±ï¸  è€—æ—¶: 245ms

...

============================================================
ğŸ“Š æµ‹è¯•æ€»ç»“
============================================================
âœ… é€šè¿‡: 8
âŒ å¤±è´¥: 0
ğŸ“ˆ æ€»è®¡: 8
â±ï¸  æ€»è€—æ—¶: 1234ms

============================================================
```

### å¤±è´¥ç¤ºä¾‹

```
ğŸ“ æµ‹è¯• 5: æ‰¹é‡å¯¼å…¥ä½“é‡è®°å½•
âŒ æ‰¹é‡å¯¼å…¥å¤±è´¥: {"success":false,"message":"Invalid data"}

â±ï¸  è€—æ—¶: 123ms

============================================================
ğŸ“Š æµ‹è¯•æ€»ç»“
============================================================
âœ… é€šè¿‡: 4
âŒ å¤±è´¥: 1
ğŸ“ˆ æ€»è®¡: 5

============================================================
```

---

## ğŸ” è°ƒè¯•æŠ€å·§

### 1. å¯ç”¨è°ƒè¯•æ¨¡å¼

```bash
DEBUG=true npm run test:pet
```

è°ƒè¯•æ¨¡å¼ä¼šè¾“å‡ºï¼š
- è¯·æ±‚ URL
- è¯·æ±‚æ–¹æ³•
- è¯·æ±‚å¤´
- è¯·æ±‚ä½“

### 2. æŸ¥çœ‹æœåŠ¡å™¨æ—¥å¿—

åœ¨å¦ä¸€ä¸ªç»ˆç«¯çª—å£æŸ¥çœ‹æœåŠ¡å™¨æ—¥å¿—ï¼š

```bash
# æœåŠ¡å™¨ä¼šè¾“å‡ºè¯¦ç»†çš„è¯·æ±‚æ—¥å¿—
npm run dev
```

### 3. ä½¿ç”¨ HTTP æµ‹è¯•æ–‡ä»¶

å¯¹äºå•ä¸ªç«¯ç‚¹çš„æµ‹è¯•ï¼Œå¯ä»¥ä½¿ç”¨ VSCode REST Client æ’ä»¶ï¼š

```
backend/pet-api-tests.http
```

---

## ğŸ› å¸¸è§é—®é¢˜

### Q: æµ‹è¯•å¤±è´¥ï¼Œæç¤º "Connection refused"

**A**: ç¡®ä¿åç«¯æœåŠ¡æ­£åœ¨è¿è¡Œï¼š
```bash
npm run dev
```

### Q: æµ‹è¯•å¤±è´¥ï¼Œæç¤º "Timeout"

**A**: å¯èƒ½æ˜¯æ•°æ®åº“è¿æ¥æ…¢ï¼Œå¢åŠ è¶…æ—¶æ—¶é—´ï¼š
```bash
TIMEOUT=60000 npm run test:pet
```

### Q: å¦‚ä½•æ¸…ç†æµ‹è¯•æ•°æ®ï¼Ÿ

**A**: æµ‹è¯•è„šæœ¬ä¼šè‡ªåŠ¨åˆ›å»ºç‹¬ç«‹çš„æµ‹è¯•ç”¨æˆ·ï¼Œä¸ä¼šå½±å“ç°æœ‰æ•°æ®ã€‚å¦‚éœ€æ¸…ç†ï¼š
```bash
# é‡ç½®æ•°æ®åº“ï¼ˆè°¨æ…ä½¿ç”¨ï¼‰
npm run prisma:migrate -- reset
```

### Q: æµ‹è¯•é€šè¿‡ä½†åŠŸèƒ½è¿˜æ˜¯æœ‰é—®é¢˜ï¼Ÿ

**A**: æµ‹è¯•åªè¦†ç›–åŸºæœ¬åŠŸèƒ½ï¼Œå»ºè®®ï¼š
1. å¯ç”¨ DEBUG æ¨¡å¼æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
2. ä½¿ç”¨ HTTP æµ‹è¯•æ–‡ä»¶æ‰‹åŠ¨æµ‹è¯•
3. æŸ¥çœ‹æœåŠ¡å™¨æ—¥å¿—

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [API æ€»ç»“æ–‡æ¡£](../docs/Pet-API-æ€»ç»“.md) - å®Œæ•´çš„ API æ–‡æ¡£
- [é¡¹ç›®å¼€å‘æŒ‡å—](../PROJECT-GUIDELINES.md) - å¼€å‘è§„èŒƒå’Œæœ€ä½³å®è·µ
- [æ•°æ®åº“è®¾è®¡](../prisma/schema.prisma) - Prisma Schema

---

## ğŸ¤ è´¡çŒ®

å¦‚æœä½ å‘ç°æµ‹è¯•é—®é¢˜æˆ–æƒ³æ·»åŠ æ–°çš„æµ‹è¯•ç”¨ä¾‹ï¼š

1. åœ¨ `backend/scripts/` ç›®å½•ä¸‹åˆ›å»ºæˆ–ä¿®æ”¹æµ‹è¯•è„šæœ¬
2. éµå¾ªç°æœ‰çš„æµ‹è¯•ç»“æ„å’Œå‘½åè§„èŒƒ
3. ç¡®ä¿æ‰€æœ‰æµ‹è¯•éƒ½èƒ½é€šè¿‡
4. æ›´æ–°æœ¬æ–‡æ¡£

---

**æœ€åæ›´æ–°**: 2025-11-04
**ç‰ˆæœ¬**: 1.0.0
