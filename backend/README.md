# LittleFriendGarden Backend

åŸºäº Express + Prisma + PostgreSQL çš„åç«¯ API æœåŠ¡ã€‚

---

## ğŸ“‹ ç›®å½•

- [æŠ€æœ¯æ ˆ](#-æŠ€æœ¯æ ˆ)
- [å¿«é€Ÿå¼€å§‹](#-å¿«é€Ÿå¼€å§‹)
- [æ–‡æ¡£å¯¼èˆª](#-æ–‡æ¡£å¯¼èˆª)
- [æ•°æ®åº“æ¨¡å‹](#ï¸-æ•°æ®åº“æ¨¡å‹)
- [é¡¹ç›®ç»“æ„](#-é¡¹ç›®ç»“æ„)
- [ç¯å¢ƒå˜é‡è¯´æ˜](#-ç¯å¢ƒå˜é‡è¯´æ˜)

---

## ğŸ’» æŠ€æœ¯æ ˆ

æœ¬é¡¹ç›®é‡‡ç”¨ç°ä»£ Node.js æŠ€æœ¯æ ˆï¼Œå…·ä½“æŠ€æœ¯é€‰å‹å’Œæ¶æ„è®¾è®¡è¯·æŸ¥çœ‹ï¼š

ğŸ‘‰ **[åç«¯æŠ€æœ¯æ–¹æ¡ˆ](docs/åç«¯æŠ€æœ¯æ–¹æ¡ˆ.md)**

æ ¸å¿ƒæŠ€æœ¯ï¼š
- **Node.js 18+** + **Express.js** - Web æ¡†æ¶
- **Prisma 5.x** - ORM æ•°æ®åº“æ˜ å°„
- **PostgreSQL 13+** - å…³ç³»å‹æ•°æ®åº“

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

```bash
# 1. å®‰è£…ä¾èµ–
npm install

# 2. é…ç½®ç¯å¢ƒå˜é‡
cp .env.example .env

# 3. è¿è¡Œæ•°æ®åº“è¿ç§»
npm run prisma:migrate

# 4. å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm run dev
```

**è¯¦ç»†éƒ¨ç½²æŒ‡å—**ï¼šğŸ‘‰ **[é¡¹ç›®éƒ¨ç½²æ–‡æ¡£](docs/é¡¹ç›®éƒ¨ç½².md)**

---

## ğŸ“š æ–‡æ¡£å¯¼èˆª

### ğŸŒŸ å¿…è¯»æ–‡æ¡£
- ğŸ“Œ **[PROJECT-GUIDELINES.md](PROJECT-GUIDELINES.md)** - **é¡¹ç›®å¼€å‘åŸºå‡†æ–‡ä»¶**ï¼ˆå¿…è¯»ï¼åŒ…å«æ‰€æœ‰çº¦æŸå’Œè§„èŒƒï¼‰

### æ ¸å¿ƒæ–‡æ¡£
- ğŸš€ **[é¡¹ç›®éƒ¨ç½²](docs/é¡¹ç›®éƒ¨ç½².md)** - å¼€å‘ç¯å¢ƒé…ç½®ã€éƒ¨ç½²æŒ‡å—ã€å¸¸è§é—®é¢˜
- ğŸ› ï¸ **[åç«¯æŠ€æœ¯æ–¹æ¡ˆ](docs/åç«¯æŠ€æœ¯æ–¹æ¡ˆ.md)** - æŠ€æœ¯é€‰å‹ã€æ¶æ„è®¾è®¡ã€å¼€å‘è§„èŒƒ
- ğŸ“Š **[æ•°æ®åº“æ¨¡å‹](docs/æ•°æ®åº“æ¨¡å‹.md)** - å®Œæ•´çš„æ•°æ®åº“è¡¨ç»“æ„å’Œå­—æ®µè¯´æ˜
- âš ï¸ **[é”™è¯¯å¤„ç†å’Œæ—¥å¿—æŒ‡å—](docs/é”™è¯¯å¤„ç†å’Œæ—¥å¿—æŒ‡å—.md)** - é”™è¯¯å¤„ç†ã€æ—¥å¿—ç³»ç»Ÿã€è¯·æ±‚è¿½è¸ª
- ğŸ“Œ **[é”™è¯¯å¤„ç†å¿«é€Ÿå‚è€ƒ](docs/é”™è¯¯å¤„ç†å¿«é€Ÿå‚è€ƒ.md)** - å¿«é€ŸæŸ¥è¯¢å’Œå¸¸ç”¨ç¤ºä¾‹

### è¿›åº¦è·Ÿè¸ª
- ğŸ“‹ **[è¿ç§»è¿›åº¦](docs/è¿ç§»è¿›åº¦.md)** - æ•°æ®åº“è¿ç§»è¿›åº¦è·Ÿè¸ª
- âœ… **[è¿ç§»å®Œæˆæ€»ç»“](docs/è¿ç§»å®Œæˆæ€»ç»“.md)** - Auth åŸŸè¿ç§»å®ŒæˆæŠ¥å‘Š

### å¤–éƒ¨å‚è€ƒ
- [Prisma æ–‡æ¡£](https://www.prisma.io/docs/)
- [Express æ–‡æ¡£](https://expressjs.com/)
- [PostgreSQL æ–‡æ¡£](https://www.postgresql.org/docs/)

---

## ğŸ—„ï¸ æ•°æ®åº“æ¨¡å‹

å½“å‰å·²å®Œæˆ **Auth åŸŸ**ï¼ˆè´¦å·ä¸èº«ä»½ï¼‰çš„ 7 å¼ è¡¨è®¾è®¡å’Œè¿ç§»ï¼š

- âœ… **User** - ç”¨æˆ·ä¸»è¡¨ï¼ˆæ”¯æŒ email/username å¤§å°å†™ä¸æ•æ„Ÿï¼‰
- âœ… **UserProfile** - ç”¨æˆ·æ¡£æ¡ˆï¼ˆ1:1 å…³ç³»ï¼‰
- âœ… **UserIdentity** - ç¬¬ä¸‰æ–¹èº«ä»½ï¼ˆOAuth/Apple/WeChatï¼‰
- âœ… **UserFollow** - å…³æ³¨å…³ç³»
- âœ… **UserBlock** - å±è”½å…³ç³»
- âœ… **Notification** - é€šçŸ¥ä¸­å¿ƒ
- âœ… **UserTodo** - ç”¨æˆ·å¾…åŠï¼ˆæ”¯æŒæ ‡ç­¾æœç´¢ï¼‰

**è¯¦ç»†æ¨¡å‹è¯´æ˜**ï¼šğŸ‘‰ **[æ•°æ®åº“æ¨¡å‹æ–‡æ¡£](docs/æ•°æ®åº“æ¨¡å‹.md)**

---

## ğŸ“ é¡¹ç›®ç»“æ„

```
backend/
â”œâ”€â”€ docs/                         # ğŸ“š é¡¹ç›®æ–‡æ¡£
â”‚   â”œâ”€â”€ é¡¹ç›®éƒ¨ç½².md                 # éƒ¨ç½²å’Œå¼€å‘ç¯å¢ƒæŒ‡å—
â”‚   â”œâ”€â”€ åç«¯æŠ€æœ¯æ–¹æ¡ˆ.md             # æŠ€æœ¯é€‰å‹å’Œæ¶æ„è®¾è®¡
â”‚   â”œâ”€â”€ æ•°æ®åº“æ¨¡å‹.md               # æ•°æ®åº“è¡¨ç»“æ„è¯´æ˜
â”‚   â”œâ”€â”€ é”™è¯¯å¤„ç†å’Œæ—¥å¿—æŒ‡å—.md       # é”™è¯¯å¤„ç†å’Œæ—¥å¿—ç³»ç»Ÿ
â”‚   â”œâ”€â”€ è¿ç§»è¿›åº¦.md                 # è¿ç§»è¿›åº¦è·Ÿè¸ª
â”‚   â””â”€â”€ è¿ç§»å®Œæˆæ€»ç»“.md             # Auth åŸŸè¿ç§»æŠ¥å‘Š
â”œâ”€â”€ lib/
â”‚   â””â”€â”€ prisma.js                 # Prisma Client å•ä¾‹
â”œâ”€â”€ logs/                         # æ—¥å¿—æ–‡ä»¶ï¼ˆ.gitignoreï¼‰
â”‚   â”œâ”€â”€ combined.log              # æ‰€æœ‰æ—¥å¿—
â”‚   â”œâ”€â”€ error.log                 # é”™è¯¯æ—¥å¿—
â”‚   â”œâ”€â”€ exceptions.log            # æœªæ•è·å¼‚å¸¸
â”‚   â””â”€â”€ rejections.log            # æœªå¤„ç†çš„ Promise æ‹’ç»
â”œâ”€â”€ prisma/
â”‚   â”œâ”€â”€ schema.prisma             # æ•°æ®åº“æ¨¡å‹å®šä¹‰
â”‚   â””â”€â”€ migrations/               # æ•°æ®åº“è¿ç§»æ–‡ä»¶
â”œâ”€â”€ scripts/
â”‚   â””â”€â”€ verify-database.js        # æ•°æ®åº“éªŒè¯è„šæœ¬
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â””â”€â”€ logger.js             # Winston æ—¥å¿—é…ç½®
â”‚   â”œâ”€â”€ errors/                   # è‡ªå®šä¹‰é”™è¯¯ç±»
â”‚   â”‚   â”œâ”€â”€ BaseError.js
â”‚   â”‚   â”œâ”€â”€ ValidationError.js
â”‚   â”‚   â”œâ”€â”€ AuthError.js
â”‚   â”‚   â”œâ”€â”€ NotFoundError.js
â”‚   â”‚   â”œâ”€â”€ ConflictError.js
â”‚   â”‚   â”œâ”€â”€ DatabaseError.js
â”‚   â”‚   â””â”€â”€ index.js
â”‚   â””â”€â”€ middleware/               # Express ä¸­é—´ä»¶
â”‚       â”œâ”€â”€ errorHandler.js       # é”™è¯¯å¤„ç†ä¸­é—´ä»¶
â”‚       â”œâ”€â”€ requestLogger.js      # è¯·æ±‚æ—¥å¿—ä¸­é—´ä»¶
â”‚       â””â”€â”€ index.js
â”œâ”€â”€ app.js                        # Express åº”ç”¨å…¥å£
â”œâ”€â”€ test-error-logging.js         # é”™è¯¯å’Œæ—¥å¿—æµ‹è¯•æ–‡ä»¶
â”œâ”€â”€ .env                          # ç¯å¢ƒå˜é‡ï¼ˆä¸æäº¤åˆ° Gitï¼‰
â”œâ”€â”€ .env.example                  # ç¯å¢ƒå˜é‡ç¤ºä¾‹
â”œâ”€â”€ package.json                  # é¡¹ç›®é…ç½®
â””â”€â”€ README.md                     # æœ¬æ–‡ä»¶
```

---

## ğŸ” ç¯å¢ƒå˜é‡è¯´æ˜

åœ¨ `.env` æ–‡ä»¶ä¸­é…ç½®ä»¥ä¸‹ç¯å¢ƒå˜é‡ï¼š

| å˜é‡ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| `DATABASE_URL` | PostgreSQL è¿æ¥å­—ç¬¦ä¸² | `postgresql://user:pass@localhost:5432/db-LFG` |
| `JWT_SECRET` | JWT ç­¾åå¯†é’¥ | `your-secret-key` |
| `JWT_EXPIRES_IN` | JWT è¿‡æœŸæ—¶é—´ | `7d` |
| `PORT` | æœåŠ¡ç«¯å£ | `3000` |
| `NODE_ENV` | è¿è¡Œç¯å¢ƒ | `development` / `production` |

> ğŸ’¡ **æç¤º**ï¼šè¯¦ç»†çš„ç¯å¢ƒé…ç½®å’Œéƒ¨ç½²è¯´æ˜è¯·æŸ¥çœ‹ [é¡¹ç›®éƒ¨ç½²æ–‡æ¡£](docs/é¡¹ç›®éƒ¨ç½².md)

---

## ğŸ“¦ å¯ç”¨è„šæœ¬

| è„šæœ¬ | è¯´æ˜ |
|------|------|
| `npm run dev` | å¯åŠ¨å¼€å‘æœåŠ¡å™¨ï¼ˆå¸¦çƒ­é‡è½½ï¼‰ |
| `npm start` | å¯åŠ¨ç”Ÿäº§æœåŠ¡å™¨ |
| `npm run prisma:migrate` | è¿è¡Œæ•°æ®åº“è¿ç§» |
| `npm run prisma:generate` | ç”Ÿæˆ Prisma Client |
| `npm run prisma:studio` | æ‰“å¼€ Prisma Studioï¼ˆæ•°æ®åº“ GUIï¼‰ |
| `npm run db:verify` | éªŒè¯æ•°æ®åº“è¡¨ç»“æ„ |

---

**å¼€å§‹å¼€å‘ï¼Ÿ** ğŸ‘‰ æŸ¥çœ‹ [é¡¹ç›®éƒ¨ç½²æ–‡æ¡£](docs/é¡¹ç›®éƒ¨ç½².md) è·å–å®Œæ•´çš„å¼€å‘ç¯å¢ƒé…ç½®æŒ‡å—ã€‚

**äº†è§£æ¶æ„ï¼Ÿ** ğŸ‘‰ æŸ¥çœ‹ [åç«¯æŠ€æœ¯æ–¹æ¡ˆ](docs/åç«¯æŠ€æœ¯æ–¹æ¡ˆ.md) äº†è§£æŠ€æœ¯é€‰å‹å’Œè®¾è®¡åŸåˆ™ã€‚
